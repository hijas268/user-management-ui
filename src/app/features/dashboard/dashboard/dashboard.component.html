<div class="container dashboard-container mt-4">
  <h2>User Management</h2>

  <!-- Add User Form -->
  <div class="form-section">
    <h3>Add User</h3>
    <div class="row gx-10">
      <div class="col-md-2 col-gap">
        <input type="text" class="form-control" placeholder="Username" [(ngModel)]="newUser.Username" />
      </div>
      <div class="col-md-2">
        <input type="email" class="form-control" placeholder="Email" [(ngModel)]="newUser.Email" />
      </div>
        <div class="col-md-2">
        <input type="password" class="form-control" placeholder="Password" [(ngModel)]="newUser.Password" />
      </div>
      <div class="col-md-2">
        <select class="form-select" [(ngModel)]="roleid" aria-placeholder="Please Select UserType">
            <option value="">Please Select</option>
          <option value="1">Admin</option>
          <option value="2">User</option>
          <option value="3">ReadOnlyUser</option>
        </select>
      </div>
      <div class="col-md-1">
        <button class="btn btn-primary" (click)="addUser()">Add</button>
      </div>
    </div>
  </div>

  <!-- Edit User Form -->
  <div *ngIf="selectedUser" class="form-section mb-4">
    <h3>Edit User</h3>
    <div class="row">
      <div class="col-md-3">
        <input type="text" class="form-control" [(ngModel)]="selectedUser.username" placeholder="Username" />
      </div>
      <div class="col-md-3">
        <input type="email" class="form-control" [(ngModel)]="selectedUser.email" placeholder="Email" />
      </div>
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="selectedUser.roleId" >
            <option value="">Please Select</option>
          <option value="1">Admin</option>
          <option value="2">User</option>
          <option value="3">ReadOnlyUser</option>
        </select>
      </div>
      <div class="col-md-3 d-flex gap-2">
        <button class="btn btn-success" (click)="updateUser()">Update</button>
        <button class="btn btn-secondary" (click)="resetForm()">Cancel</button>
      </div>
    </div>
  </div>
<hr />
<br>
  <!-- Search & Filter -->
  <div class="filter-bar mb-3 row g-2">
    <div class="col-md-6">
      <input type="text" class="form-control" placeholder="Search by username/email" [(ngModel)]="searchTerm" (input)="loadUsers()" />
    </div>
    <div class="col-md-3">
      <select class="form-select" [(ngModel)]="roleFilter" (change)="loadUsers()">
        <option value="">All Roles</option>
        <option value="1">Admin</option>
        <option value="2">User</option>
        <option value="3">ReadOnlyUser</option>
      </select>
    </div>
  </div>

  <!-- User Table -->
  <table class="table user-table">
    <thead>
      <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Role</th>
        <th>Created</th>
        <th>Last Modified</th>
        <th *ngIf="getuserprofile.isAdmin()">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of users">
        <td data-label="Username">{{ user.username }}</td>
        <td data-label="Email">{{ user.email }}</td>
        <td data-label="Role">{{ getRoleName(user.roleId) }}</td>
        <td data-label="Created At">{{ user.createdAt | date: 'short' }}</td>
        <td data-label="Last Modified">{{ user.lastModifiedAt | date: 'short' }}</td>
        <td data-label="Actions" class="d-flex gap-2" *ngIf="getuserprofile.isAdmin()">
          <button class="btn btn-sm btn-primary" (click)="editUser(user)">Edit</button>
          <button class="btn btn-sm btn-danger" (click)="deleteUser(user.id)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
    <div class="pagination">
    <button (click)="prevPage()" [disabled]="page === 1">Prev</button>
    <span>Page {{ page }}</span>
    <button (click)="nextPage()" [disabled]="page * pageSize >= total">Next</button>
  </div>
</div>
